{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>webscan</title>
    <link rel="stylesheet" href="{% static '/css/home.css' %}" />
    <script>
      function showLoader() {
        document.getElementById("loader").style.display = "block"; // Show loader
      }
    </script>
  </head>
  <body>
    <nav class="navbar">
      <div class="navbar-left">
        <a href="{% url 'home' %}" class="logo">WebScan</a>
        <a href="{% url 'index' %}" class="nav-link" style="color: white"
          >Home</a
        >
        <!-- Home link -->
      </div>
      <div class="navbar-right">
        <div class="username">{{ request.user.username }}</div>
        <div class="profile-dropdown">
          <img
            src="{% static '/images/avatar.png' %}"
            alt="Profile Icon"
            class="profile-icon"
          />
          <div class="logout-popup">
            <a href="{% url 'logout' %}">Logout</a>
          </div>
        </div>
      </div>
    </nav>

    <div class="tab-container">
      <div class="tabs">
        <button class="tab-button" onclick="showTab('scan')">Scan</button>
        <button class="tab-button" onclick="showTab('history')">History</button>
      </div>
      <div class="tab-content">
        <!-- Scan Form -->
        <div id="scan" class="tab-content-section">
          <div class="form-container">
            <form class="scan-form" method="GET" action="{% url 'scan'%}">
              <div class="form-group">
                <input
                  type="text"
                  id="url"
                  name="url"
                  placeholder="Enter domain, URL, or IP"
                  required
                />
              </div>
              <div class="form-group">
                <button type="submit">Scan</button>
              </div>
            </form>
            <div id="loader" style="display: none">Scanning in progress...</div>
            <div
              id="progressMessage"
              style="color: blue; margin-top: 10px"
            ></div>
            {% if error %}
            <p style="color: red">{{ error }}</p>
            {% endif %}
          </div>
        </div>

        <!-- History Table -->
        <div id="history" class="tab-content-section" style="display: none">
          <table class="history-table">
            <thead>
              <tr>
                <th>S.NO</th>
                <th>Host</th>
                <th>Report Name</th>
                <th>Scan date</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for result in scan_results %}
              <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ result.domain }}</td>
                <td>{{ result.report_name }}</td>
                <td>{{ result.scan_date }}</td>
                <td>
                  <a href="{% url 'view_scan_report' result.report_name %}"
                    >View Result</a
                  >
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5">No scan history available.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script src="{% static '/js/home.js' %}"></script>
    <script>
      showTab("scan");
    </script>
  </body>
</html>
